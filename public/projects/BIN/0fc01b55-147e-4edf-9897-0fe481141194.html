<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Breathing Exercise Visualizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Minimal style block for custom properties or complex selectors if needed */
        /* Example: Targeting generated content or specific states not easily handled by Tailwind */
        /* Keeping this minimal as per requirements */
        .visualizer-circle {
            /* Base transition for smooth scaling */
            transition-property: transform, background-color;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            /* Duration will be set dynamically via JS */
        }
        /* Define states for transitions */
        .state-inhale { transform: scale(1.15); background-color: #60a5fa; /* blue-400 */ }
        .state-hold { transform: scale(1.15); background-color: #facc15; /* yellow-400 */ }
        .state-exhale { transform: scale(0.85); background-color: #a78bfa; /* violet-400 */ }
        .state-idle { transform: scale(1); background-color: #34d399; /* emerald-400 */ }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 font-sans antialiased">

    <div class="container mx-auto px-4 py-8 min-h-screen flex flex-col">

        <header class="text-center mb-8 md:mb-12">
            <h1 class="text-3xl md:text-4xl font-bold text-blue-600 dark:text-blue-400">Breathing Exercise Visualizer</h1>
            <p class="text-lg text-gray-600 dark:text-gray-400 mt-2">Find your calm, one breath at a time.</p>
        </header>

        <main class="flex-grow flex flex-col lg:flex-row items-center justify-center gap-8 md:gap-12">

            <!-- Visualizer Section -->
            <section class="w-full lg:w-1/2 flex flex-col items-center justify-center text-center p-6 bg-white dark:bg-gray-800 rounded-lg shadow-lg h-96">
                <div id="visualizer" class="relative w-48 h-48 md:w-64 md:h-64 mb-6">
                    <div id="circle" class="visualizer-circle state-idle w-full h-full rounded-full flex items-center justify-center shadow-md">
                        </div>
                        <span id="instruction" class="absolute inset-0 flex items-center justify-center text-xl md:text-2xl font-semibold text-white mix-blend-difference pointer-events-none">
                            Ready
                        </span>
                </div>
                 <p class="text-sm text-gray-500 dark:text-gray-400">Follow the visual cues and instructions.</p>
            </section>

            <!-- Controls Section -->
            <section class="w-full lg:w-1/2 p-6 bg-white dark:bg-gray-800 rounded-lg shadow-lg">
                <h2 class="text-2xl font-semibold mb-6 text-center text-blue-600 dark:text-blue-400">Customize Your Session</h2>

                <div class="mb-6">
                    <h3 class="text-lg font-medium mb-3 text-center">Breathing Pattern (Seconds)</h3>
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 text-center">
                        <div>
                            <label for="inhale" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Inhale</label>
                            <input type="number" id="inhale" name="inhale" value="4" min="1" max="30" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-center focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="hold1" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Hold</label>
                            <input type="number" id="hold1" name="hold1" value="4" min="0" max="30" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-center focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="exhale" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Exhale</label>
                            <input type="number" id="exhale" name="exhale" value="4" min="1" max="30" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-center focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="hold2" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Hold</label>
                            <input type="number" id="hold2" name="hold2" value="4" min="0" max="30" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-center focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                </div>

                <div class="mb-6">
                    <h3 class="text-lg font-medium mb-3 text-center">Preset Patterns</h3>
                    <div class="flex flex-wrap justify-center gap-3">
                        <button onclick="setPattern(4, 4, 4, 4)" class="px-4 py-2 bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 text-sm font-medium rounded-md transition duration-150 ease-in-out">Box (4-4-4-4)</button>
                        <button onclick="setPattern(4, 7, 8, 0)" class="px-4 py-2 bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 text-sm font-medium rounded-md transition duration-150 ease-in-out">Relax (4-7-8)</button>
                        <button onclick="setPattern(5, 0, 5, 0)" class="px-4 py-2 bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 text-sm font-medium rounded-md transition duration-150 ease-in-out">Coherent (5-5)</button>
                    </div>
                </div>

                <div class="text-center">
                    <button id="startStopBtn" onclick="toggleBreathCycle()" class="w-full sm:w-auto px-8 py-3 bg-emerald-500 hover:bg-emerald-600 dark:bg-emerald-600 dark:hover:bg-emerald-700 text-white text-lg font-semibold rounded-lg shadow-md transition duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800">
                        Start
                    </button>
                </div>

            </section>

        </main>

        <footer class="text-center mt-8 md:mt-12 py-4 border-t border-gray-200 dark:border-gray-700">
            <p class="text-sm text-gray-500 dark:text-gray-400">&copy; 2023 BreatheEasy Visualizer. All rights reserved.</p>
        </footer>

    </div>

    <script>
        const circle = document.getElementById('circle');
        const instruction = document.getElementById('instruction');
        const startStopBtn = document.getElementById('startStopBtn');
        const inhaleInput = document.getElementById('inhale');
        const hold1Input = document.getElementById('hold1');
        const exhaleInput = document.getElementById('exhale');
        const hold2Input = document.getElementById('hold2');

        let state = 'idle'; // idle, inhale, hold1, exhale, hold2
        let isRunning = false;
        let timerId = null;
        let timings = { inhale: 4, hold1: 4, exhale: 4, hold2: 4 };

        function getTimings() {
            timings.inhale = parseInt(inhaleInput.value) || 1;
            timings.hold1 = parseInt(hold1Input.value) || 0;
            timings.exhale = parseInt(exhaleInput.value) || 1;
            timings.hold2 = parseInt(hold2Input.value) || 0;
            // Ensure minimum duration for animation visibility
            if (timings.inhale < 1) timings.inhale = 1;
            if (timings.exhale < 1) timings.exhale = 1;
        }

        function updateVisualizer(newState, text, duration) {
            state = newState;
            instruction.textContent = text;
            circle.className = `visualizer-circle w-full h-full rounded-full flex items-center justify-center shadow-md state-${state}`;
            circle.style.transitionDuration = `${duration}s`;
            // console.log(`State: ${state}, Text: ${text}, Duration: ${duration}s`);
        }

        function breathCycle() {
            getTimings(); // Get latest timings

            switch (state) {
                case 'idle':
                case 'hold2':
                    updateVisualizer('inhale', 'Breathe In...', timings.inhale);
                    timerId = setTimeout(breathCycle, timings.inhale * 1000);
                    break;
                case 'inhale':
                    if (timings.hold1 > 0) {
                        updateVisualizer('hold1', 'Hold...', timings.hold1);
                        timerId = setTimeout(breathCycle, timings.hold1 * 1000);
                    } else {
                        // Skip hold1 if duration is 0
                        updateVisualizer('exhale', 'Breathe Out...', timings.exhale);
                        timerId = setTimeout(breathCycle, timings.exhale * 1000);
                    }
                    break;
                 case 'hold1':
                    updateVisualizer('exhale', 'Breathe Out...', timings.exhale);
                    timerId = setTimeout(breathCycle, timings.exhale * 1000);
                    break;
                case 'exhale':
                    if (timings.hold2 > 0) {
                        updateVisualizer('hold2', 'Hold...', timings.hold2);
                        timerId = setTimeout(breathCycle, timings.hold2 * 1000);
                    } else {
                        // Skip hold2 if duration is 0, loop back to inhale
                        updateVisualizer('inhale', 'Breathe In...', timings.inhale);
                        timerId = setTimeout(breathCycle, timings.inhale * 1000);
                    }
                    break;
            }
        }

        function start() {
            if (isRunning) return;
            isRunning = true;
            startStopBtn.textContent = 'Stop';
            startStopBtn.classList.remove('bg-emerald-500', 'hover:bg-emerald-600', 'dark:bg-emerald-600', 'dark:hover:bg-emerald-700');
            startStopBtn.classList.add('bg-red-500', 'hover:bg-red-600', 'dark:bg-red-600', 'dark:hover:bg-red-700');
            // Start the cycle immediately
            breathCycle();
        }

        function stop() {
            if (!isRunning) return;
            isRunning = false;
            clearTimeout(timerId);
            timerId = null;
            updateVisualizer('idle', 'Ready', 0.5); // Reset visualizer smoothly
            startStopBtn.textContent = 'Start';
            startStopBtn.classList.remove('bg-red-500', 'hover:bg-red-600', 'dark:bg-red-600', 'dark:hover:bg-red-700');
            startStopBtn.classList.add('bg-emerald-500', 'hover:bg-emerald-600', 'dark:bg-emerald-600', 'dark:hover:bg-emerald-700');
        }

        function toggleBreathCycle() {
            if (isRunning) {
                stop();
            } else {
                start();
            }
        }

        function setPattern(inhale, hold1, exhale, hold2) {
            inhaleInput.value = inhale;
            hold1Input.value = hold1;
            exhaleInput.value = exhale;
            hold2Input.value = hold2;
            if (isRunning) {
                stop(); // Stop if running to apply new pattern on next start
            } else {
                 updateVisualizer('idle', 'Ready', 0.5); // Ensure reset state if stopped
            }
        }

        // Initialize with default pattern values visible
        setPattern(4, 4, 4, 4);
        // Ensure initial state is visually correct
        updateVisualizer('idle', 'Ready', 0.5);

    </script>

</body>
</html>