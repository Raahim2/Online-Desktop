
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minimalist Rhythm Game</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #111827; /* bg-gray-900 */
            color: white;
            font-family: 'Arial', sans-serif;
            overflow: hidden; /* Prevent scrollbars */
            margin: 0; /* Remove default body margin */
            height: 100vh; /* Ensure body takes full viewport height */
            display: flex; /* Use flexbox for centering */
            justify-content: center;
            align-items: center;
        }
        #game-container {
            position: relative; /* Needed for absolute positioning of swatches */
            width: 100%;
            height: 100%;
            overflow: hidden; /* Keep swatches within container boundaries if needed */
        }
        .swatch {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.1s ease;
            position: absolute; /* Position swatches absolutely within the container */
            will-change: top; /* Hint browser about animation */
        }
        .swatch:active {
            transform: scale(0.9);
        }

        #ui-container {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 10; /* Ensure UI is above swatches */
            background-color: rgba(0, 0, 0, 0.5); /* Slight background for readability */
            padding: 10px;
            border-radius: 5px;
        }
        #score {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        #combo {
            font-size: 1rem;
        }
        #game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            font-weight: bold;
            background-color: rgba(0, 0, 0, 0.8);
            padding: 20px 40px;
            border-radius: 10px;
            text-align: center;
            z-index: 20; /* Above everything else */
            display: none; /* Hidden by default */
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">

    <div id="ui-container">
        <div id="score">Score: 0</div>
        <div id="combo">Combo: 0</div>
    </div>

    <div id="game-container">
        <!-- Swatches will be added here by JavaScript -->
    </div>

    <div id="game-over">
        Game Over!<br>
        Score: <span id="final-score">0</span><br>
        <span style="font-size: 1rem; font-weight: normal;">Click to Restart</span>
    </div>

    <script>
        const gameContainer = document.getElementById('game-container');
        const scoreDisplay = document.getElementById('score');
        const comboDisplay = document.getElementById('combo');
        const gameOverDisplay = document.getElementById('game-over');
        const finalScoreDisplay = document.getElementById('final-score');

        let score = 0;
        let combo = 0;
        let fallSpeed = 2; // Pixels per frame (adjust for desired speed)
        let spawnInterval = 1500; // Milliseconds between spawns
        let maxSwatches = 1; // How many swatches to spawn at once
        let lastSpawnTime = 0;
        let activeSwatches = []; // Array to hold active swatch data
        let animationFrameId = null;
        let gameRunning = false;

        const colors = [
            'bg-red-500', 'bg-orange-500', 'bg-yellow-500',
            'bg-green-500', 'bg-blue-500', 'bg-indigo-500',
            'bg-purple-500', 'bg-pink-500'
        ];

        function createSwatchElement(colorClass, xPos) {
            const swatch = document.createElement('div');
            swatch.classList.add('swatch', 'm-2', colorClass); // Removed rounded-full, absolute, transition-transform as they are in CSS
            swatch.style.left = `${xPos}px`;
            swatch.style.top = '-50px'; // Start above the screen
            swatch.addEventListener('click', handleSwatchClick);
            gameContainer.appendChild(swatch);
            return swatch;
        }

        function handleSwatchClick(event) {
            if (!gameRunning) return;

            const clickedElement = event.target;
            // Find the index of the clicked swatch in our activeSwatches array
            const index = activeSwatches.findIndex(sw => sw.element === clickedElement);

            if (index > -1) {
                score += 10 + combo; // Add combo bonus to score
                combo++;
                updateScore();

                // Remove swatch from array and DOM
                activeSwatches.splice(index, 1);
                clickedElement.remove();

                // Increase difficulty slightly on successful click
                adjustDifficulty();
            }
        }

        function updateScore() {
            scoreDisplay.textContent = `Score: ${score}`;
            comboDisplay.textContent = `Combo: ${combo}`;
        }

        function spawnSwatches() {
            for (let i = 0; i < maxSwatches; i++) {
                const randomColor = colors[Math.floor(Math.random() * colors.length)];
                const randomX = Math.random() * (gameContainer.clientWidth - 60) + 5; // -60 for width+margin, +5 for margin offset
                const swatchElement = createSwatchElement(randomColor, randomX);

                // Add swatch data to our tracking array
                activeSwatches.push({
                    element: swatchElement,
                    top: -50 // Store initial numeric position
                });
            }
        }

        function adjustDifficulty() {
            // Example: Increase speed slightly every 5 combo points
            if (combo > 0 && combo % 5 === 0) {
                 fallSpeed += 0.1;
            }
             // Example: Decrease spawn interval slightly every 100 score points (make it faster)
            if (score > 0 && score % 100 === 0 && spawnInterval > 400) { // Don't let it get too fast
                spawnInterval -= 50;
            }
             // Example: Occasionally spawn more swatches at higher scores
            if (score > 300 && Math.random() < 0.01) { // Low chance to increase max swatches
                 maxSwatches = Math.min(3, maxSwatches + 1); // Cap at 3 simultaneous spawns
            }
        }

        function gameLoop(timestamp) {
            if (!gameRunning) return;

            // --- Spawning ---
            if (timestamp - lastSpawnTime > spawnInterval) {
                spawnSwatches();
                lastSpawnTime = timestamp;
            }

            // --- Update positions and check for misses ---
            const missedIndices = []; // Keep track of indices to remove
            const containerHeight = gameContainer.clientHeight;

            activeSwatches.forEach((swatchData, index) => {
                swatchData.top += fallSpeed; // Update numeric position
                swatchData.element.style.top = `${swatchData.top}px`; // Update visual position

                // Check if swatch is missed (went past the bottom)
                if (swatchData.top > containerHeight) {
                    missedIndices.push(index);
                    swatchData.element.remove(); // Remove from DOM immediately
                    if (combo > 0) {
                        console.log("Missed! Combo reset.");
                        combo = 0; // Reset combo on miss
                        updateScore(); // Update display
                    }
                }
            });

            // --- Remove missed swatches from the active array ---
            // Iterate backwards to safely remove elements using splice
            for (let i = missedIndices.length - 1; i >= 0; i--) {
                activeSwatches.splice(missedIndices[i], 1);
            }


             // --- Add a simple game over condition (e.g., too many missed) ---
             // This is just an example, you could use lives, time, etc.
             // Let's say game over if 5 swatches are missed in total (needs a counter)
             // For simplicity here, let's just keep it running. Add a proper condition if desired.


            // --- Request next frame ---
            animationFrameId = requestAnimationFrame(gameLoop);
        }

        function startGame() {
            console.log("Starting game...");
            // Reset state
            score = 0;
            combo = 0;
            fallSpeed = 2;
            spawnInterval = 1500;
            maxSwatches = 1;
            lastSpawnTime = 0; // Reset spawn timer
            gameOverDisplay.style.display = 'none'; // Hide game over screen

            // Clear existing swatches from DOM and array
            activeSwatches.forEach(sw => sw.element.remove());
            activeSwatches = [];
            gameContainer.innerHTML = ''; // Clear container just in case


            updateScore();
            gameRunning = true;

            // Cancel any previous loop and start a new one
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
            }
            animationFrameId = requestAnimationFrame(gameLoop);
        }

        function endGame() {
            console.log("Game Over!");
            gameRunning = false;
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
            }
            finalScoreDisplay.textContent = score;
            gameOverDisplay.style.display = 'block';
        }

        // --- Event Listeners ---
        gameOverDisplay.addEventListener('click', startGame); // Restart on click

        // Start game on load
        window.addEventListener('load', () => {
            // Need a slight delay or interaction to start audio in some browsers if sound is added later
            // For now, just start directly. Maybe add a "Click to Start" button initially.
             startGame(); // Start the game automatically for now

             // Example: Add a simple game over trigger for testing
             // setTimeout(endGame, 30000); // End game after 30 seconds
        });

        // Optional: Handle resize - restarting is the simplest
        let resizeTimeout;
        window.addEventListener('resize', () => {
            // Debounce resize event
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                if (gameRunning) {
                    console.log("Resized - Restarting game");
                    // Pausing and repositioning is complex, restart is easier
                    endGame(); // Show game over briefly
                    // Optionally restart automatically after a short delay
                    // setTimeout(startGame, 1000);
                    // Or just let the user click to restart from the game over screen
                }
            }, 250); // Adjust debounce delay as needed
        });

    </script>

</body>
</html>
