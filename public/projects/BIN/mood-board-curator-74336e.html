<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mood Board Curator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js" integrity="sha512-Eezs+g9Lq4TCCq0wae01s97ufKNPix0bdJ/gcsgc0pgSPVBGBqDzzXRyYjc9T09H9gKUURmMefNeKAzaKU5KOw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoeqMV/TJlSKda6FXzoEyYGjTe+vXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        /* Custom scrollbar for webkit browsers */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        /* Style for dragged item */
        .sortable-ghost {
            opacity: 0.4;
            border: 2px dashed #cbd5e1;
        }
        .sortable-drag {
            opacity: 0.9 !important;
            cursor: grabbing !important;
        }
        /* Ensure board images don't overflow */
        #moodBoard .board-item img {
            max-width: 100%;
            max-height: 100%;
            object-fit: cover;
            display: block; /* Remove extra space below image */
        }
         /* Prevent text selection during drag */
        body.dragging, body.dragging * {
            user-select: none !important;
            -webkit-user-select: none !important;
            -moz-user-select: none !important;
            -ms-user-select: none !important;
        }
        /* Placeholder styling */
        #moodBoard.empty {
            display: flex;
            justify-content: center;
            align-items: center;
            color: #9ca3af; /* text-gray-400 */
            font-style: italic;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans antialiased">

    <div class="flex flex-col md:flex-row h-screen overflow-hidden">

        <!-- Sidebar: Image Library & Controls -->
        <aside class="w-full md:w-1/3 lg:w-1/4 xl:w-1/5 bg-white shadow-md flex flex-col overflow-hidden">
            <header class="p-4 border-b">
                <h1 class="text-xl font-semibold text-gray-800">Mood Board Curator</h1>
            </header>

            <!-- Search & Filters -->
            <div class="p-4 border-b">
                <input type="search" id="searchInput" placeholder="Search images (e.g., nature, city)" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition duration-150 ease-in-out" aria-label="Search images">
            </div>

            <!-- Image Library Grid -->
            <div id="imageLibrary" class="flex-grow overflow-y-auto p-4 grid grid-cols-3 sm:grid-cols-4 md:grid-cols-2 lg:grid-cols-3 gap-2">
                <!-- Images will be loaded here by JavaScript -->
            </div>

             <!-- Controls -->
            <div class="p-4 border-t mt-auto bg-gray-50">
                 <h2 class="text-lg font-medium mb-3 text-gray-700">Board Controls</h2>

                 <!-- Background Options -->
                 <div class="mb-4">
                     <label for="bgColor" class="block text-sm font-medium text-gray-600 mb-1">Background Color</label>
                     <div class="flex space-x-2">
                         <button data-bg="bg-white" class="w-6 h-6 rounded-full border border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-indigo-500" aria-label="Set background white"></button>
                         <button data-bg="bg-gray-100" class="w-6 h-6 rounded-full border border-gray-300 bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-indigo-500" aria-label="Set background light gray"></button>
                         <button data-bg="bg-slate-200" class="w-6 h-6 rounded-full border border-gray-300 bg-slate-200 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-indigo-500" aria-label="Set background slate"></button>
                         <button data-bg="bg-zinc-800" class="w-6 h-6 rounded-full border border-gray-300 bg-zinc-800 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-indigo-500" aria-label="Set background dark zinc"></button>
                         <button data-bg="bg-rose-100" class="w-6 h-6 rounded-full border border-gray-300 bg-rose-100 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-indigo-500" aria-label="Set background rose"></button>
                         <button data-bg="bg-teal-100" class="w-6 h-6 rounded-full border border-gray-300 bg-teal-100 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-indigo-500" aria-label="Set background teal"></button>
                     </div>
                 </div>

                 <!-- Action Buttons -->
                 <div class="grid grid-cols-2 gap-2">
                     <button id="saveButton" class="w-full px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out text-sm">
                         Save Board
                     </button>
                     <button id="loadButton" class="w-full px-3 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition duration-150 ease-in-out text-sm">
                         Load Board
                     </button>
                     <button id="downloadButton" class="col-span-2 w-full px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition duration-150 ease-in-out text-sm">
                         Download as Image
                     </button>
                      <button id="clearButton" class="col-span-2 w-full px-3 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition duration-150 ease-in-out text-sm">
                         Clear Board
                     </button>
                 </div>
                 <p id="statusMessage" class="text-xs text-gray-500 mt-2 h-4"></p>
            </div>
        </aside>

        <!-- Main Content: Mood Board -->
        <main class="flex-grow bg-gray-200 overflow-auto p-4 md:p-8 relative">
            <div id="moodBoardWrapper" class="w-full h-full">
                 <div id="moodBoard" class="moodboard-canvas bg-white shadow-lg w-full min-h-[600px] md:min-h-full h-auto p-4 grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 xl:grid-cols-8 gap-4 transition-colors duration-300 ease-in-out empty">
                    <!-- Dropped images will appear here -->
                    Drag images here to start building your mood board!
                 </div>
            </div>
        </main>

    </div>

    <script>
        const imageLibraryData = [
            { id: 1, url: 'https://source.unsplash.com/300x300/?minimalist,architecture', tags: ['minimalist', 'architecture', 'building', 'white'] },
            { id: 2, url: 'https://source.unsplash.com/300x300/?nature,forest', tags: ['nature', 'forest', 'trees', 'green', 'woods'] },
            { id: 3, url: 'https://source.unsplash.com/300x300/?city,night', tags: ['city', 'night', 'urban', 'lights', 'skyline'] },
            { id: 4, url: 'https://source.unsplash.com/300x300/?ocean,beach', tags: ['ocean', 'beach', 'sea', 'water', 'sand', 'coast'] },
            { id: 5, url: 'https://source.unsplash.com/300x300/?mountain,landscape', tags: ['mountain', 'landscape', 'nature', 'scenic', 'peak'] },
            { id: 6, url: 'https://source.unsplash.com/300x300/?abstract,texture', tags: ['abstract', 'texture', 'pattern', 'background'] },
            { id: 7, url: 'https://source.unsplash.com/300x300/?food,coffee', tags: ['food', 'coffee', 'cafe', 'drink', 'morning'] },
            { id: 8, url: 'https://source.unsplash.com/300x300/?technology,code', tags: ['technology', 'code', 'computer', 'programming', 'tech'] },
            { id: 9, url: 'https://source.unsplash.com/300x300/?travel,explore', tags: ['travel', 'explore', 'adventure', 'map', 'journey'] },
            { id: 10, url: 'https://source.unsplash.com/300x300/?fashion,style', tags: ['fashion', 'style', 'clothing', 'model', 'design'] },
            { id: 11, url: 'https://source.unsplash.com/300x300/?interior,design', tags: ['interior', 'design', 'home', 'decor', 'room'] },
            { id: 12, url: 'https://source.unsplash.com/300x300/?art,paint', tags: ['art', 'paint', 'creative', 'color', 'brush'] },
            { id: 13, url: 'https://source.unsplash.com/300x300/?animal,cat', tags: ['animal', 'cat', 'pet', 'cute', 'feline'] },
            { id: 14, url: 'https://source.unsplash.com/300x300/?space,galaxy', tags: ['space', 'galaxy', 'stars', 'universe', 'cosmos'] },
            { id: 15, url: 'https://source.unsplash.com/300x300/?vintage,retro', tags: ['vintage', 'retro', 'old', 'classic', 'style'] },
            { id: 16, url: 'https://source.unsplash.com/300x300/?music,concert', tags: ['music', 'concert', 'sound', 'performance', 'live'] },
            { id: 17, url: 'https://source.unsplash.com/300x300/?gradient,color', tags: ['gradient', 'color', 'abstract', 'background', 'blur'] },
            { id: 18, url: 'https://source.unsplash.com/300x300/?geometric,pattern', tags: ['geometric', 'pattern', 'shape', 'abstract', 'design'] },
            { id: 19, url: 'https://source.unsplash.com/300x300/?plant,leaf', tags: ['plant', 'leaf', 'green', 'nature', 'botanical'] },
            { id: 20, url: 'https://source.unsplash.com/300x300/?sky,clouds', tags: ['sky', 'clouds', 'blue', 'weather', 'day'] },
        ];

        const imageLibraryEl = document.getElementById('imageLibrary');
        const moodBoardEl = document.getElementById('moodBoard');
        const searchInput = document.getElementById('searchInput');
        const saveButton = document.getElementById('saveButton');
        const loadButton = document.getElementById('loadButton');
        const downloadButton = document.getElementById('downloadButton');
        const clearButton = document.getElementById('clearButton');
        const bgColorButtons = document.querySelectorAll('[data-bg]');
        const statusMessageEl = document.getElementById('statusMessage');

        let currentBgClass = 'bg-white'; // Default background

        // --- Populate Image Library ---
        function displayImages(images) {
            imageLibraryEl.innerHTML = ''; // Clear existing images
            images.forEach(img => {
                const div = document.createElement('div');
                div.classList.add('library-item', 'aspect-square', 'bg-gray-200', 'rounded', 'overflow-hidden', 'cursor-grab', 'hover:opacity-75', 'transition-opacity');
                div.dataset.id = img.id;
                div.dataset.url = img.url;
                div.innerHTML = `<img src="${img.url}" alt="${img.tags.join(', ')}" class="w-full h-full object-cover pointer-events-none">`;
                imageLibraryEl.appendChild(div);
            });
        }

        // --- Search Functionality ---
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase().trim();
            const filteredImages = imageLibraryData.filter(img => {
                return searchTerm === '' || img.tags.some(tag => tag.toLowerCase().includes(searchTerm));
            });
            displayImages(filteredImages);
        });

        // --- Drag and Drop Initialization (SortableJS) ---
        let librarySortable, boardSortable;

        function initializeSortables() {
            if (librarySortable) librarySortable.destroy();
            if (boardSortable) boardSortable.destroy();

            librarySortable = new Sortable(imageLibraryEl, {
                group: {
                    name: 'shared',
                    pull: 'clone', // Clone items from library
                    put: false // Do not allow items to be put back into library
                },
                animation: 150,
                sort: false, // Do not sort items in the library
                onStart: () => document.body.classList.add('dragging'),
                onEnd: () => document.body.classList.remove('dragging'),
            });

            boardSortable = new Sortable(moodBoardEl, {
                group: 'shared', // Allow items from 'shared' group (library) to be dropped here
                animation: 150,
                item: '.board-item', // Specify draggable items within the board
                onAdd: function (evt) {
                    // Customize the cloned item when added to the board
                    const itemEl = evt.item;
                    const originalUrl = itemEl.dataset.url; // Get URL from original library item data attribute

                    itemEl.classList.remove('library-item', 'aspect-square', 'bg-gray-200', 'cursor-grab');
                    itemEl.classList.add('board-item', 'relative', 'group', 'aspect-square', 'overflow-hidden', 'rounded'); // Added aspect-square here
                    itemEl.innerHTML = `
                        <img src="${originalUrl}" alt="Mood board image" class="w-full h-full object-cover pointer-events-none">
                        <button class="absolute top-1 right-1 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition-opacity focus:outline-none focus:ring-2 focus:ring-red-400" onclick="this.parentElement.remove(); updateBoardState();" aria-label="Remove image">X</button>
                    `;
                    itemEl.removeAttribute('data-id'); // Remove library-specific data if needed
                    itemEl.removeAttribute('data-url'); // Remove library-specific data if needed
                    itemEl.dataset.boardUrl = originalUrl; // Add specific attribute for board items

                    updateBoardState();
                },
                onUpdate: updateBoardState, // Handle reordering within the board
                onRemove: updateBoardState, // Handle removing (though handled by button click now)
                onStart: () => document.body.classList.add('dragging'),
                onEnd: () => document.body.classList.remove('dragging'),
            });
        }

        // --- Board State Management ---
        function updateBoardState() {
            if (moodBoardEl.children.length > 0) {
                moodBoardEl.classList.remove('empty', 'items-center', 'justify-center');
                if (moodBoardEl.firstChild.nodeType === Node.TEXT_NODE) {
                     moodBoardEl.removeChild(moodBoardEl.firstChild); // Remove placeholder text
                }
            } else {
                 moodBoardEl.classList.add('empty', 'items-center', 'justify-center');
                 moodBoardEl.textContent = 'Drag images here to start building your mood board!';
            }
        }

        // --- Background Customization ---
        bgColorButtons.forEach(button => {
            button.addEventListener('click', () => {
                const newBgClass = button.dataset.bg;
                // Remove previous bg class (find based on pattern)
                const currentClasses = moodBoardEl.className.split(' ');
                currentClasses.forEach(cls => {
                    if (cls.startsWith('bg-')) {
                        moodBoardEl.classList.remove(cls);
                    }
                });
                // Add new bg class
                moodBoardEl.classList.add(newBgClass);
                currentBgClass = newBgClass; // Update current background tracker
                showStatusMessage('Background updated.', 'success');
            });
        });

        // --- Status Message ---
        let statusTimeout;
        function showStatusMessage(message, type = 'info') {
            clearTimeout(statusTimeout);
            statusMessageEl.textContent = message;
            statusMessageEl.className = 'text-xs mt-2 h-4'; // Reset classes
            if (type === 'success') {
                statusMessageEl.classList.add('text-green-600');
            } else if (type === 'error') {
                statusMessageEl.classList.add('text-red-600');
            } else {
                statusMessageEl.classList.add('text-gray-500');
            }
            statusTimeout = setTimeout(() => {
                statusMessageEl.textContent = '';
                statusMessageEl.className = 'text-xs text-gray-500 mt-2 h-4';
            }, 3000);
        }


        // --- Save Functionality ---
        saveButton.addEventListener('click', () => {
            const boardImages = Array.from(moodBoardEl.querySelectorAll('.board-item img')).map(img => img.src);
            const boardData = {
                images: boardImages,
                background: currentBgClass
            };
            try {
                localStorage.setItem('moodBoardData', JSON.stringify(boardData));
                showStatusMessage('Board saved successfully!', 'success');
            } catch (e) {
                 console.error("Error saving to local storage:", e);
                 showStatusMessage('Error saving board. Storage might be full.', 'error');
            }
        });

        // --- Load Functionality ---
        loadButton.addEventListener('click', () => {
            const savedData = localStorage.getItem('moodBoardData');
            if (savedData) {
                try {
                    const boardData = JSON.parse(savedData);

                    // Clear current board
                    moodBoardEl.innerHTML = '';

                    // Apply background
                    const currentClasses = moodBoardEl.className.split(' ');
                    currentClasses.forEach(cls => {
                        if (cls.startsWith('bg-')) {
                            moodBoardEl.classList.remove(cls);
                        }
                    });
                    moodBoardEl.classList.add(boardData.background || 'bg-white');
                    currentBgClass = boardData.background || 'bg-white';

                    // Add images
                    if (boardData.images && boardData.images.length > 0) {
                         boardData.images.forEach(imageUrl => {
                            const div = document.createElement('div');
                            div.classList.add('board-item', 'relative', 'group', 'aspect-square', 'overflow-hidden', 'rounded');
                            div.dataset.boardUrl = imageUrl;
                            div.innerHTML = `
                                <img src="${imageUrl}" alt="Mood board image" class="w-full h-full object-cover pointer-events-none">
                                <button class="absolute top-1 right-1 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition-opacity focus:outline-none focus:ring-2 focus:ring-red-400" onclick="this.parentElement.remove(); updateBoardState();" aria-label="Remove image">X</button>
                            `;
                            moodBoardEl.appendChild(div);
                        });
                    }

                    updateBoardState(); // Update placeholder visibility
                    showStatusMessage('Board loaded successfully!', 'success');

                } catch (e) {
                    console.error("Error parsing saved data:", e);
                    showStatusMessage('Error loading board. Saved data might be corrupt.', 'error');
                     moodBoardEl.innerHTML = ''; // Clear potentially broken state
                     updateBoardState();
                }

            } else {
                showStatusMessage('No saved board found.', 'info');
            }
        });

        // --- Clear Board Functionality ---
        clearButton.addEventListener('click', () => {
             if (confirm('Are you sure you want to clear the entire board? This cannot be undone.')) {
                 moodBoardEl.innerHTML = '';
                 // Reset background to default
                 const currentClasses = moodBoardEl.className.split(' ');
                 currentClasses.forEach(cls => {
                     if (cls.startsWith('bg-')) {
                         moodBoardEl.classList.remove(cls);
                     }
                 });
                 moodBoardEl.classList.add('bg-white');
                 currentBgClass = 'bg-white';
                 updateBoardState();
                 showStatusMessage('Board cleared.', 'info');
             }
        });


        // --- Download Functionality ---
        downloadButton.addEventListener('click', () => {
            showStatusMessage('Preparing download...', 'info');
            // Temporarily remove delete buttons for cleaner screenshot
            const deleteButtons = moodBoardEl.querySelectorAll('.board-item button');
            deleteButtons.forEach(btn => btn.style.display = 'none');

            html2canvas(moodBoardEl, {
                allowTaint: true, // Allow loading cross-origin images (like from Unsplash)
                useCORS: true,    // Attempt to use CORS for fetching images
                logging: false,   // Reduce console noise
                scale: window.devicePixelRatio * 1.5 // Increase scale for better resolution
            }).then(canvas => {
                // Restore delete buttons
                deleteButtons.forEach(btn => btn.style.display = '');

                const image = canvas.toDataURL('image/png', 0.9); // Use PNG with slight compression
                const link = document.createElement('a');
                link.download = 'mood-board.png';
                link.href = image;
                link.click();
                showStatusMessage('Download started!', 'success');
            }).catch(error => {
                 // Restore delete buttons even on error
                deleteButtons.forEach(btn => btn.style.display = '');
                console.error('Error generating canvas:', error);
                showStatusMessage('Error creating download.', 'error');
            });
        });


        // --- Initial Load ---
        displayImages(imageLibraryData);
        initializeSortables();
        updateBoardState(); // Check initial state for placeholder
        // Attempt to load saved board on startup
        // loadButton.click(); // Optional: uncomment to auto-load on page refresh

    </script>

</body>
</html>