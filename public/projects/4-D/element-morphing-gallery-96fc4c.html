<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Element Morphing Gallery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Optional: Add custom styles or fine-tune Tailwind defaults here */
        body {
            background-color: #f0f4f8; /* Light background */
            font-family: 'Inter', sans-serif; /* Requires importing Inter or using a system font stack */
        }
        /* Improve focus visibility for keyboard navigation */
        .gallery-item:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5); /* Tailwind blue-500 focus ring */
            z-index: 10; /* Bring focused item slightly forward */
        }
        /* Ensure smooth transitions on the image itself */
        .gallery-item img {
            transition: transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1), filter 0.3s ease-in-out;
        }
        /* Style for the caption */
        .gallery-item figcaption {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
</head>
<body class="antialiased">

    <header class="py-8 px-4 text-center">
        <h1 class="text-3xl md:text-4xl font-bold text-gray-800">Element Morphing Gallery</h1>
        <p class="mt-2 text-lg text-gray-600">Hover near images to see them react.</p>
    </header>

    <main class="container mx-auto px-4 py-8">
        <div id="gallery-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 md:gap-8">

            <!-- Gallery Item 1 -->
            <figure class="gallery-item group aspect-square relative overflow-hidden rounded-lg shadow-md cursor-pointer" tabindex="0">
                <img src="https://picsum.photos/seed/picsum1/600/600" alt="Abstract Landscape 1" class="block w-full h-full object-cover">
                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-colors duration-300 ease-in-out"></div>
                <figcaption class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/70 to-transparent text-white opacity-0 group-hover:opacity-100 transform translate-y-4 group-hover:translate-y-0 pointer-events-none">
                    <span class="block font-semibold text-lg">Abstract 1</span>
                    <span class="block text-sm">Vibrant colors meet</span>
                </figcaption>
            </figure>

            <!-- Gallery Item 2 -->
            <figure class="gallery-item group aspect-square relative overflow-hidden rounded-lg shadow-md cursor-pointer" tabindex="0">
                <img src="https://picsum.photos/seed/picsum2/600/600" alt="Abstract Landscape 2" class="block w-full h-full object-cover">
                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-colors duration-300 ease-in-out"></div>
                <figcaption class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/70 to-transparent text-white opacity-0 group-hover:opacity-100 transform translate-y-4 group-hover:translate-y-0 pointer-events-none">
                    <span class="block font-semibold text-lg">Structure II</span>
                    <span class="block text-sm">Geometric forms</span>
                </figcaption>
            </figure>

            <!-- Gallery Item 3 -->
            <figure class="gallery-item group aspect-square relative overflow-hidden rounded-lg shadow-md cursor-pointer" tabindex="0">
                <img src="https://picsum.photos/seed/picsum3/600/600" alt="Abstract Landscape 3" class="block w-full h-full object-cover">
                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-colors duration-300 ease-in-out"></div>
                <figcaption class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/70 to-transparent text-white opacity-0 group-hover:opacity-100 transform translate-y-4 group-hover:translate-y-0 pointer-events-none">
                    <span class="block font-semibold text-lg">Coastal Dream</span>
                    <span class="block text-sm">Oceanic textures</span>
                </figcaption>
            </figure>

            <!-- Gallery Item 4 -->
            <figure class="gallery-item group aspect-square relative overflow-hidden rounded-lg shadow-md cursor-pointer" tabindex="0">
                <img src="https://picsum.photos/seed/picsum4/600/600" alt="Abstract Landscape 4" class="block w-full h-full object-cover">
                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-colors duration-300 ease-in-out"></div>
                <figcaption class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/70 to-transparent text-white opacity-0 group-hover:opacity-100 transform translate-y-4 group-hover:translate-y-0 pointer-events-none">
                    <span class="block font-semibold text-lg">Forest Light</span>
                    <span class="block text-sm">Dappled sunlight</span>
                </figcaption>
            </figure>

            <!-- Gallery Item 5 -->
            <figure class="gallery-item group aspect-square relative overflow-hidden rounded-lg shadow-md cursor-pointer" tabindex="0">
                <img src="https://picsum.photos/seed/picsum5/600/600" alt="Abstract Landscape 5" class="block w-full h-full object-cover">
                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-colors duration-300 ease-in-out"></div>
                <figcaption class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/70 to-transparent text-white opacity-0 group-hover:opacity-100 transform translate-y-4 group-hover:translate-y-0 pointer-events-none">
                    <span class="block font-semibold text-lg">Mountain Peak</span>
                    <span class="block text-sm">Crisp alpine air</span>
                </figcaption>
            </figure>

            <!-- Gallery Item 6 -->
            <figure class="gallery-item group aspect-square relative overflow-hidden rounded-lg shadow-md cursor-pointer" tabindex="0">
                <img src="https://picsum.photos/seed/picsum6/600/600" alt="Abstract Landscape 6" class="block w-full h-full object-cover">
                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-colors duration-300 ease-in-out"></div>
                <figcaption class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/70 to-transparent text-white opacity-0 group-hover:opacity-100 transform translate-y-4 group-hover:translate-y-0 pointer-events-none">
                    <span class="block font-semibold text-lg">Urban Flow</span>
                    <span class="block text-sm">Cityscape energy</span>
                </figcaption>
            </figure>

            <!-- Gallery Item 7 -->
            <figure class="gallery-item group aspect-square relative overflow-hidden rounded-lg shadow-md cursor-pointer" tabindex="0">
                <img src="https://picsum.photos/seed/picsum7/600/600" alt="Abstract Landscape 7" class="block w-full h-full object-cover">
                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-colors duration-300 ease-in-out"></div>
                <figcaption class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/70 to-transparent text-white opacity-0 group-hover:opacity-100 transform translate-y-4 group-hover:translate-y-0 pointer-events-none">
                    <span class="block font-semibold text-lg">Desert Haze</span>
                    <span class="block text-sm">Warm sandy tones</span>
                </figcaption>
            </figure>

            <!-- Gallery Item 8 -->
            <figure class="gallery-item group aspect-square relative overflow-hidden rounded-lg shadow-md cursor-pointer" tabindex="0">
                <img src="https://picsum.photos/seed/picsum8/600/600" alt="Abstract Landscape 8" class="block w-full h-full object-cover">
                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-colors duration-300 ease-in-out"></div>
                <figcaption class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/70 to-transparent text-white opacity-0 group-hover:opacity-100 transform translate-y-4 group-hover:translate-y-0 pointer-events-none">
                    <span class="block font-semibold text-lg">Frozen Lake</span>
                    <span class="block text-sm">Icy reflections</span>
                </figcaption>
            </figure>
             <!-- Add more gallery items as needed -->
             <figure class="gallery-item group aspect-square relative overflow-hidden rounded-lg shadow-md cursor-pointer" tabindex="0">
                <img src="https://picsum.photos/seed/picsum9/600/600" alt="Abstract Landscape 9" class="block w-full h-full object-cover">
                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-colors duration-300 ease-in-out"></div>
                <figcaption class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/70 to-transparent text-white opacity-0 group-hover:opacity-100 transform translate-y-4 group-hover:translate-y-0 pointer-events-none">
                    <span class="block font-semibold text-lg">Nebula Cloud</span>
                    <span class="block text-sm">Cosmic dust swirls</span>
                </figcaption>
            </figure>
            <figure class="gallery-item group aspect-square relative overflow-hidden rounded-lg shadow-md cursor-pointer" tabindex="0">
                <img src="https://picsum.photos/seed/picsum10/600/600" alt="Abstract Landscape 10" class="block w-full h-full object-cover">
                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-colors duration-300 ease-in-out"></div>
                <figcaption class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/70 to-transparent text-white opacity-0 group-hover:opacity-100 transform translate-y-4 group-hover:translate-y-0 pointer-events-none">
                    <span class="block font-semibold text-lg">Metal Texture</span>
                    <span class="block text-sm">Industrial sheen</span>
                </figcaption>
            </figure>
            <figure class="gallery-item group aspect-square relative overflow-hidden rounded-lg shadow-md cursor-pointer" tabindex="0">
                <img src="https://picsum.photos/seed/picsum11/600/600" alt="Abstract Landscape 11" class="block w-full h-full object-cover">
                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-colors duration-300 ease-in-out"></div>
                <figcaption class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/70 to-transparent text-white opacity-0 group-hover:opacity-100 transform translate-y-4 group-hover:translate-y-0 pointer-events-none">
                    <span class="block font-semibold text-lg">Paper Folds</span>
                    <span class="block text-sm">Origami shadows</span>
                </figcaption>
            </figure>
            <figure class="gallery-item group aspect-square relative overflow-hidden rounded-lg shadow-md cursor-pointer" tabindex="0">
                <img src="https://picsum.photos/seed/picsum12/600/600" alt="Abstract Landscape 12" class="block w-full h-full object-cover">
                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-colors duration-300 ease-in-out"></div>
                <figcaption class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/70 to-transparent text-white opacity-0 group-hover:opacity-100 transform translate-y-4 group-hover:translate-y-0 pointer-events-none">
                    <span class="block font-semibold text-lg">Liquid Gold</span>
                    <span class="block text-sm">Molten flow effect</span>
                </figcaption>
            </figure>

        </div>
    </main>

    <footer class="text-center py-6 mt-8 text-gray-500 text-sm">
        <p>&copy; 2023 Element Morphing Gallery. All rights reserved.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const galleryContainer = document.getElementById('gallery-container');
            const galleryItems = document.querySelectorAll('.gallery-item');
            let mouseX = 0;
            let mouseY = 0;
            let rafId = null; // Request Animation Frame ID

            // --- Configuration ---
            const maxScale = 1.15; // Max scale factor on closest proximity
            const minScale = 0.95; // Min scale factor when mouse is far (or default 1.0)
            const effectRadius = 400; // Radius around the cursor where the effect is strongest (pixels)
            const scalePower = 1.5; // Higher value = faster scaling near center
            const dampFactor = 0.1; // Smoothing factor (lower = smoother, but more delay)

            // Store target scales and current scales for smoothing
            const itemData = Array.from(galleryItems).map(item => ({
                element: item,
                img: item.querySelector('img'),
                rect: null, // Cache bounding rect
                centerX: 0,
                centerY: 0,
                targetScale: 1.0,
                currentScale: 1.0,
                targetFilter: 'brightness(100%) saturate(100%)',
                currentBrightness: 100,
                currentSaturate: 100,
                targetBrightness: 100,
                targetSaturate: 100
            }));

            // --- Debounced Rect Calculation ---
            let debounceTimer;
            function calculateRects() {
                itemData.forEach(data => {
                    data.rect = data.element.getBoundingClientRect();
                    data.centerX = data.rect.left + data.rect.width / 2;
                    data.centerY = data.rect.top + data.rect.height / 2;
                });
            }

            function debouncedCalculateRects() {
                clearTimeout(debounceTimer);
                debounceTimer = setTimeout(calculateRects, 100); // Recalculate on resize/scroll after delay
            }

            // Initial calculation
            calculateRects();
            window.addEventListener('resize', debouncedCalculateRects);
            window.addEventListener('scroll', debouncedCalculateRects, { passive: true }); // Use passive listener for scroll

            // --- Mouse Tracking ---
            galleryContainer.addEventListener('mousemove', (e) => {
                // Get mouse position relative to the viewport
                mouseX = e.clientX;
                mouseY = e.clientY;
                // Start animation loop if not already running
                if (!rafId) {
                    rafId = requestAnimationFrame(updateGalleryItems);
                }
            }, { passive: true }); // Use passive listener for mousemove

            galleryContainer.addEventListener('mouseleave', () => {
                 // Reset to default state when mouse leaves the container
                itemData.forEach(data => {
                    data.targetScale = 1.0;
                    data.targetBrightness = 100;
                    data.targetSaturate = 100;
                });
                 if (!rafId) { // Ensure update loop runs to animate back
                    rafId = requestAnimationFrame(updateGalleryItems);
                }
            });


            // --- Animation Loop ---
            function updateGalleryItems() {
                let needsUpdate = false;

                itemData.forEach(data => {
                    if (!data.rect) return; // Skip if rect not calculated yet

                    const dx = mouseX - data.centerX;
                    const dy = mouseY - data.centerY;
                    const distance = Math.sqrt(dx * dx + dy * dy);

                    // Calculate effect intensity (0 to 1) based on distance
                    const proximityFactor = Math.max(0, 1 - distance / effectRadius); // Linear falloff
                    const effectIntensity = Math.pow(proximityFactor, scalePower); // Apply power curve

                    // Calculate target scale based on intensity
                    data.targetScale = minScale + (maxScale - minScale) * effectIntensity;

                    // Calculate subtle color shifts (optional)
                    // Example: slightly desaturate and brighten further away items
                    data.targetBrightness = 100 + (95 - 100) * (1 - effectIntensity); // Range: 95% to 100%
                    data.targetSaturate = 100 + (80 - 100) * (1 - effectIntensity); // Range: 80% to 100%


                    // --- Smoothing (Lerp) ---
                    data.currentScale += (data.targetScale - data.currentScale) * dampFactor;
                    data.currentBrightness += (data.targetBrightness - data.currentBrightness) * dampFactor;
                    data.currentSaturate += (data.targetSaturate - data.currentSaturate) * dampFactor;

                    // Apply transformations and filters
                    // Check if the change is significant enough to warrant a style update
                    if (Math.abs(data.currentScale - parseFloat(data.img.style.transform.replace(/[^0-9.]/g, '') || 1)) > 0.001 ||
                        Math.abs(data.currentBrightness - (parseFloat(data.img.style.filter.match(/brightness\((.*?)\)/)?.[1]) || 100)) > 0.1 ||
                        Math.abs(data.currentSaturate - (parseFloat(data.img.style.filter.match(/saturate\((.*?)\)/)?.[1]) || 100)) > 0.1)
                    {
                        data.img.style.transform = `scale(${data.currentScale.toFixed(3)})`;
                        data.img.style.filter = `brightness(${data.currentBrightness.toFixed(1)}%) saturate(${data.currentSaturate.toFixed(1)}%)`;
                        needsUpdate = true;
                    }
                });

                // Continue the loop only if changes are happening or target isn't reached
                if (needsUpdate || itemData.some(d => Math.abs(d.currentScale - d.targetScale) > 0.001)) {
                    rafId = requestAnimationFrame(updateGalleryItems);
                } else {
                    rafId = null; // Stop the loop when idle
                }
            }

            // --- Keyboard Navigation Enhancement (Focus Handling) ---
            // Basic focus is handled by tabindex and browser defaults.
            // This adds arrow key navigation within the grid.

            galleryContainer.addEventListener('keydown', (e) => {
                const currentFocusedIndex = itemData.findIndex(data => data.element === document.activeElement);
                if (currentFocusedIndex === -1 && (e.key.startsWith('Arrow') || e.key === 'Home' || e.key === 'End')) {
                     // If no item is focused, focus the first one on arrow key press
                     if (galleryItems.length > 0) {
                        galleryItems[0].focus();
                        e.preventDefault();
                     }
                     return;
                }
                if (currentFocusedIndex === -1) return; // Only act if a gallery item is focused

                const items = Array.from(galleryItems); // Get live node list as array
                const numItems = items.length;
                let targetIndex = currentFocusedIndex;

                // Calculate grid columns dynamically (approximation based on container width and item width)
                // This is a simplification; a robust solution would need ResizeObserver
                const containerWidth = galleryContainer.offsetWidth;
                const itemWidth = items[0]?.offsetWidth || 200; // Use first item's width or estimate
                const gap = parseInt(getComputedStyle(galleryContainer).gap) || 16; // Get gap or estimate
                const approxCols = Math.max(1, Math.floor((containerWidth + gap) / (itemWidth + gap)));


                switch (e.key) {
                    case 'ArrowRight':
                        targetIndex = (currentFocusedIndex + 1) % numItems;
                        break;
                    case 'ArrowLeft':
                        targetIndex = (currentFocusedIndex - 1 + numItems) % numItems;
                        break;
                    case 'ArrowDown':
                        targetIndex = Math.min(numItems - 1, currentFocusedIndex + approxCols);
                        break;
                    case 'ArrowUp':
                        targetIndex = Math.max(0, currentFocusedIndex - approxCols);
                        break;
                    case 'Home':
                         targetIndex = 0;
                         break;
                    case 'End':
                         targetIndex = numItems - 1;
                         break;
                    default:
                        return; // Don't prevent default for other keys (like Tab)
                }

                if (targetIndex !== currentFocusedIndex) {
                    items[targetIndex].focus();
                    e.preventDefault(); // Prevent page scrolling with arrow keys
                }
            });

        });
    </script>

</body>
</html>