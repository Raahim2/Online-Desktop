<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Breathing Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body {
            transition: background 1.5s ease-in-out;
        }
        #breathing-circle {
            transition-property: transform, width, height;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); /* Smooth ease-in-out */
        }
        #breathing-text {
             transition: opacity 0.5s ease-in-out;
        }
        /* Custom Range Slider Styles */
        input[type=range] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: #e0e7ff; /* indigo-100 */
            border-radius: 9999px;
            outline: none;
            opacity: 0.9;
            transition: opacity .2s;
        }
        input[type=range]:hover {
            opacity: 1;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: #4f46e5; /* indigo-600 */
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
        }
        input[type=range]::-moz-range-thumb {
            width: 16px; /* Adjusted for border */
            height: 16px; /* Adjusted for border */
            background: #4f46e5; /* indigo-600 */
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
        }
         input[type=range]:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
         input[type=range]:disabled::-webkit-slider-thumb {
             background: #a5b4fc; /* indigo-300 */
             cursor: not-allowed;
         }
         input[type=range]:disabled::-moz-range-thumb {
             background: #a5b4fc; /* indigo-300 */
             cursor: not-allowed;
         }
    </style>
</head>
<body class="bg-gradient-to-br from-cyan-100 to-blue-200 font-sans overflow-hidden antialiased">

    <main class="min-h-screen flex flex-col items-center justify-center p-4 relative text-slate-700">

        <!-- Breathing Circle Area -->
        <div class="relative flex flex-col items-center justify-center w-60 h-60 sm:w-72 sm:h-72 md:w-80 md:h-80 lg:w-96 lg:h-96 mb-8">
            <div id="breathing-circle" class="absolute bg-white/60 backdrop-blur-lg rounded-full shadow-xl" style="width: 50%; height: 50%; transform: scale(1); transition-duration: 2000ms;"></div>
            <span id="breathing-text" class="z-10 text-xl sm:text-2xl md:text-3xl font-medium text-slate-800/90">Ready?</span>
        </div>

        <!-- Controls Area -->
        <div class="w-full max-w-lg bg-white/50 backdrop-blur-md p-5 sm:p-6 rounded-xl shadow-lg">
            <div class="grid grid-cols-2 gap-x-4 sm:gap-x-6 gap-y-4 mb-6">
                <div>
                    <label for="inhale-duration" class="block text-xs sm:text-sm font-medium text-slate-600 mb-1">Inhale</label>
                    <div class="flex items-center justify-between">
                        <input type="range" id="inhale-duration" min="2" max="10" value="4" class="w-full mr-2 h-2 rounded-lg appearance-none cursor-pointer range-sm accent-indigo-600">
                        <span class="text-sm text-slate-600 font-medium w-8 text-right" id="inhale-value">4s</span>
                    </div>
                </div>
                 <div>
                    <label for="hold-inhale-duration" class="block text-xs sm:text-sm font-medium text-slate-600 mb-1">Hold In</label>
                     <div class="flex items-center justify-between">
                        <input type="range" id="hold-inhale-duration" min="0" max="10" value="2" class="w-full mr-2 h-2 rounded-lg appearance-none cursor-pointer range-sm accent-indigo-600">
                        <span class="text-sm text-slate-600 font-medium w-8 text-right" id="hold-inhale-value">2s</span>
                    </div>
                </div>
                 <div>
                    <label for="exhale-duration" class="block text-xs sm:text-sm font-medium text-slate-600 mb-1">Exhale</label>
                     <div class="flex items-center justify-between">
                        <input type="range" id="exhale-duration" min="2" max="10" value="6" class="w-full mr-2 h-2 rounded-lg appearance-none cursor-pointer range-sm accent-indigo-600">
                        <span class="text-sm text-slate-600 font-medium w-8 text-right" id="exhale-value">6s</span>
                    </div>
                </div>
                 <div>
                    <label for="hold-exhale-duration" class="block text-xs sm:text-sm font-medium text-slate-600 mb-1">Hold Out</label>
                     <div class="flex items-center justify-between">
                        <input type="range" id="hold-exhale-duration" min="0" max="10" value="1" class="w-full mr-2 h-2 rounded-lg appearance-none cursor-pointer range-sm accent-indigo-600">
                        <span class="text-sm text-slate-600 font-medium w-8 text-right" id="hold-exhale-value">1s</span>
                    </div>
                </div>
            </div>

            <button id="start-stop-button" class="w-full bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 text-white font-semibold py-3 px-4 rounded-lg shadow-md transition duration-300 ease-in-out text-lg flex items-center justify-center space-x-2">
                <i class="fas fa-play"></i>
                <span>Start Breathing</span>
            </button>
        </div>

        <!-- Utility Buttons (Bottom Corner) -->
        <div class="absolute bottom-4 right-4 flex space-x-2 sm:space-x-3">
             <button id="sound-toggle" title="Toggle Sound" class="bg-white/60 hover:bg-white/80 backdrop-blur-sm text-slate-600 font-bold w-10 h-10 sm:w-12 sm:h-12 flex items-center justify-center rounded-full shadow-md transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                <i class="fas fa-volume-xmark fa-fw text-base sm:text-lg"></i>
            </button>
             <button id="fullscreen-toggle" title="Toggle Fullscreen" class="bg-white/60 hover:bg-white/80 backdrop-blur-sm text-slate-600 font-bold w-10 h-10 sm:w-12 sm:h-12 flex items-center justify-center rounded-full shadow-md transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                 <i class="fas fa-expand fa-fw text-base sm:text-lg"></i>
            </button>
        </div>

        <!-- Hidden Audio Player -->
        <audio id="ambient-sound" loop preload="none">
            <!-- Calm ambient sound from Pixabay -->
            <source src="https://cdn.pixabay.com/audio/2022/11/17/audio_706a194f1c.mp3" type="audio/mpeg">
            Your browser does not support the audio element.
        </audio>

    </main>

    <script>
        const breathingCircle = document.getElementById('breathing-circle');
        const breathingText = document.getElementById('breathing-text');
        const startStopButton = document.getElementById('start-stop-button');
        const startStopIcon = startStopButton.querySelector('i');
        const startStopText = startStopButton.querySelector('span');
        const inhaleInput = document.getElementById('inhale-duration');
        const holdInhaleInput = document.getElementById('hold-inhale-duration');
        const exhaleInput = document.getElementById('exhale-duration');
        const holdExhaleInput = document.getElementById('hold-exhale-duration');
        const inhaleValueSpan = document.getElementById('inhale-value');
        const holdInhaleValueSpan = document.getElementById('hold-inhale-value');
        const exhaleValueSpan = document.getElementById('exhale-value');
        const holdExhaleValueSpan = document.getElementById('hold-exhale-value');
        const soundToggleButton = document.getElementById('sound-toggle');
        const soundToggleIcon = soundToggleButton.querySelector('i');
        const fullscreenToggleButton = document.getElementById('fullscreen-toggle');
        const fullscreenToggleIcon = fullscreenToggleButton.querySelector('i');
        const ambientSound = document.getElementById('ambient-sound');
        const bodyElement = document.body;

        let inhaleDuration = parseInt(inhaleInput.value) * 1000;
        let holdInhaleDuration = parseInt(holdInhaleInput.value) * 1000;
        let exhaleDuration = parseInt(exhaleInput.value) * 1000;
        let holdExhaleDuration = parseInt(holdExhaleInput.value) * 1000;

        let isBreathing = false;
        let timeoutId = null;
        let currentGradientIndex = 0;
        let audioLoaded = false; // Track if audio has been loaded

        const gradients = [
            ['from-cyan-100', 'to-blue-200'],
            ['from-emerald-100', 'to-teal-200'],
            ['from-violet-100', 'to-purple-200'],
            ['from-fuchsia-100', 'to-pink-200'],
            ['from-amber-100', 'to-yellow-200'],
            ['from-sky-100', 'to-indigo-200']
        ];

        const baseBodyClasses = ['font-sans', 'overflow-hidden', 'antialiased', 'bg-gradient-to-br'];

        function updateDurationValues() {
            inhaleValueSpan.textContent = `${inhaleInput.value}s`;
            holdInhaleValueSpan.textContent = `${holdInhaleInput.value}s`;
            exhaleValueSpan.textContent = `${exhaleInput.value}s`;
            holdExhaleValueSpan.textContent = `${holdExhaleInput.value}s`;

            inhaleDuration = parseInt(inhaleInput.value) * 1000;
            holdInhaleDuration = parseInt(holdInhaleInput.value) * 1000;
            exhaleDuration = parseInt(exhaleInput.value) * 1000;
            holdExhaleDuration = parseInt(holdExhaleInput.value) * 1000;

            if (isBreathing) {
                stopBreathing(false); // Stop without resetting text immediately
                startBreathing(); // Restart with new timings
            }
        }

        function setCircleState(scale, duration, text) {
            breathingCircle.style.transitionDuration = `${duration}ms`;
            breathingCircle.style.transform = `scale(${scale})`;
            // Fade out text, wait a bit, change text, fade in
            breathingText.style.opacity = 0;
            setTimeout(() => {
                breathingText.textContent = text;
                breathingText.style.opacity = 1;
            }, 350); // Delay should be less than shortest animation phase
        }

        function changeBackgroundGradient() {
            currentGradientIndex = (currentGradientIndex + 1) % gradients.length;
            const newGradientClasses = gradients[currentGradientIndex];

            // Remove only old gradient classes, keep base classes
            const classesToRemove = bodyElement.className.split(' ').filter(cls => cls.startsWith('from-') || cls.startsWith('to-'));
            bodyElement.classList.remove(...classesToRemove);

            // Add new gradient classes
            bodyElement.classList.add(...newGradientClasses);
        }

        function breatheCycle() {
            if (!isBreathing) return;

            // 1. Inhale
            setCircleState(1.9, inhaleDuration, 'Breathe In'); // Expand (relative to initial 50% size -> 95% size)
            changeBackgroundGradient();
            timeoutId = setTimeout(() => {
                if (!isBreathing) return;

                // 2. Hold Inhale (if duration > 0)
                if (holdInhaleDuration > 50) { // Use a small threshold
                    setCircleState(1.9, 200, 'Hold'); // Quick transition to hold text
                    timeoutId = setTimeout(() => {
                        if (!isBreathing) return;
                        performExhale();
                    }, holdInhaleDuration);
                } else {
                    performExhale();
                }
            }, inhaleDuration);
        }

        function performExhale() {
             if (!isBreathing) return;
            // 3. Exhale
            setCircleState(1, exhaleDuration, 'Breathe Out'); // Contract
            timeoutId = setTimeout(() => {
                 if (!isBreathing) return;

                // 4. Hold Exhale (if duration > 0)
                if (holdExhaleDuration > 50) {
                    setCircleState(1, 200, 'Hold'); // Quick transition to hold text
                    timeoutId = setTimeout(() => {
                        if (isBreathing) breatheCycle(); // Loop back to inhale
                    }, holdExhaleDuration);
                } else {
                    if (isBreathing) breatheCycle(); // Loop back immediately
                }
            }, exhaleDuration);
        }


        function startBreathing() {
            isBreathing = true;
            startStopText.textContent = 'Stop Breathing';
            startStopIcon.classList.remove('fa-play');
            startStopIcon.classList.add('fa-stop');
            startStopButton.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
            startStopButton.classList.add('bg-rose-600', 'hover:bg-rose-700');
            [inhaleInput, holdInhaleInput, exhaleInput, holdExhaleInput].forEach(input => input.disabled = true);

            breathingText.style.opacity = 0; // Fade out 'Ready?'
            setTimeout(() => {
                breathingText.textContent = 'Get Ready...';
                breathingText.style.opacity = 1;
                 // Reset scale smoothly before starting
                breathingCircle.style.transitionDuration = `500ms`;
                breathingCircle.style.transform = 'scale(1)';
            }, 350);


            // Initial short delay before starting the first cycle
            clearTimeout(timeoutId); // Clear any previous timeouts
            timeoutId = setTimeout(breatheCycle, 2000); // Give time for "Get Ready..."
        }

        function stopBreathing(resetText = true) {
            isBreathing = false;
            clearTimeout(timeoutId);
            timeoutId = null;
            startStopText.textContent = 'Start Breathing';
             startStopIcon.classList.remove('fa-stop');
            startStopIcon.classList.add('fa-play');
            startStopButton.classList.remove('bg-rose-600', 'hover:bg-rose-700');
            startStopButton.classList.add('bg-indigo-600', 'hover:bg-indigo-700');
            [inhaleInput, holdInhaleInput, exhaleInput, holdExhaleInput].forEach(input => input.disabled = false);

            // Reset circle and text
            setCircleState(1, 500, resetText ? 'Ready?' : breathingText.textContent); // Keep current text if restarting

             // Reset background to initial state smoothly only if fully stopping
             if (resetText) {
                const classesToRemove = bodyElement.className.split(' ').filter(cls => cls.startsWith('from-') || cls.startsWith('to-'));
                bodyElement.classList.remove(...classesToRemove);
                bodyElement.classList.add(...gradients[0]); // Add initial gradient
                currentGradientIndex = 0; // Reset gradient cycle
             }
        }

        // --- Event Listeners ---

        startStopButton.addEventListener('click', () => {
            if (isBreathing) {
                stopBreathing();
            } else {
                startBreathing();
            }
        });

        [inhaleInput, holdInhaleInput, exhaleInput, holdExhaleInput].forEach(input => {
            input.addEventListener('input', updateDurationValues);
        });

        soundToggleButton.addEventListener('click', () => {
            if (!audioLoaded) {
                ambientSound.load(); // Load audio on first interaction
                audioLoaded = true;
            }
            if (ambientSound.paused) {
                ambientSound.play().catch(error => {
                    console.error("Audio play failed:", error);
                    // Maybe provide user feedback here
                    audioLoaded = false; // Allow retry on next click if it fails
                });
                soundToggleIcon.classList.remove('fa-volume-xmark');
                soundToggleIcon.classList.add('fa-volume-high');
                soundToggleButton.classList.add('text-indigo-600');
            } else {
                ambientSound.pause();
                soundToggleIcon.classList.remove('fa-volume-high');
                soundToggleIcon.classList.add('fa-volume-xmark');
                 soundToggleButton.classList.remove('text-indigo-600');
            }
        });

         // Update sound button if audio ends unexpectedly (though it's set to loop)
         ambientSound.addEventListener('pause', () => {
             if (isBreathing) return; // Ignore pauses triggered by stopBreathing
             soundToggleIcon.classList.remove('fa-volume-high');
             soundToggleIcon.classList.add('fa-volume-xmark');
             soundToggleButton.classList.remove('text-indigo-600');
         });
         ambientSound.addEventListener('play', () => {
             soundToggleIcon.classList.remove('fa-volume-xmark');
             soundToggleIcon.classList.add('fa-volume-high');
             soundToggleButton.classList.add('text-indigo-600');
         });


        fullscreenToggleButton.addEventListener('click', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    // Inform user if fullscreen fails
                    console.error(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
                    alert('Fullscreen mode could not be activated.');
                });
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        });

         // Listen for fullscreen changes (e.g., user pressing Esc)
        document.addEventListener('fullscreenchange', () => {
            if (!document.fullscreenElement) {
                fullscreenToggleIcon.classList.remove('fa-compress');
                fullscreenToggleIcon.classList.add('fa-expand');
                fullscreenToggleButton.setAttribute('title', 'Enter Fullscreen');
            } else {
                 fullscreenToggleIcon.classList.remove('fa-expand');
                 fullscreenToggleIcon.classList.add('fa-compress');
                 fullscreenToggleButton.setAttribute('title', 'Exit Fullscreen');
            }
        });


        // --- Initial Setup ---
        function initialize() {
            updateDurationValues(); // Set initial text values for sliders
            // Set initial gradient classes
            bodyElement.classList.add(...baseBodyClasses, ...gradients[0]);
            // Set initial button titles
            soundToggleButton.setAttribute('title', 'Toggle Sound');
            fullscreenToggleButton.setAttribute('title', 'Enter Fullscreen');
        }

        initialize();

    </script>

</body>
</html>